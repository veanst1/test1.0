image: node:18-alpine

variables:
  DEPLOY_TARGET: "production-server"

stages:
  - install
  - build
  - test
  - deploy

install-dependencies:
  stage: install
  script:
    - npm install
  artifacts:
    paths:
      - node_modules/
    expire_in: 1 hour

build-job:
  stage: build
  script:
    - npm run build
  artifacts:
    paths:
      - dist/

unit-test-job:
  stage: test
  script:
    - npm test
  allow_failure: false 

lint-test-job:
  stage: test
  script:
    - npm run lint

deploy-job:
  stage: deploy
  environment: production
  script:
    - echo "Deploying to $DEPLOY_TARGET..."
    - ./deploy_script.sh
  
  rules:
    - if: $CI_COMMIT_BRANCH == "main"
      when: manual  
